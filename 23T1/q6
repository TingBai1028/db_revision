# COMP3311 23T1 Final Exam
# Q6: ER -> Relational Mapping

(a) ER mapping

create table Peoples (
    id integer primary key
    name text not null
    lives_in text not null
)

create table Customers (
    id integer primary key references Peoples(id)
)

create table Accounts (
    id integer primary key
)

create table Held_by (
    account integer not null references Accounts(id)
    customer integer not null referneces Customers(id)
    primary key (customer, account)
)

create table Employees (
    id integer primary key references Peoples(id)
    salary integer check (salary > 0)
    works_in integer not null references Branches(id)
)

create table Branches (
    id integer primary key
)

Note: 
    overlap cannot be implemented

Answer:
-- Things which this schema can not implement:
-- total subclass participation of People, as it is split over multiple tables
-- total total participation of customers and accounts in Held_by relationship, as it is split over multiple tables
-- while we can enforce that all employees work in a branch, we can not enforce total participation of branches
   (i.e. the fact that every branch must have at leats 1 employee work_in)


(b) Single-table mapping

create table Peoples (
    id integer primary key
    name text not null
    lives_in text not null

    is_customer boolean not null -- single table
    is_employee boolean not null

    works_in integer
    salary integer check (salary >= 0)

    constraint emp_data check (
        (is_employee = false and salary is null and works_in is null)
        or 
        (is_employee = true and salary > 0 and works_in is not null)
    ),
    constraint total_participation check (
        is_customer = true or is_employee = true
    )
);

create table Held_by (
    customer integer references People(id)
    account integer references Accounts(id)
    primary key (customer, account)
)

Note:
    cannot enforce total participation

answer: 
    -- total participation of custormers and accounts in held_by relationship, as it is split over multiple tables
    -- fact that only customers can hevae a held_by relationship as it is split over multiple tables.